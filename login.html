<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>抽菸排隊系統</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<style>
*{box-sizing:border-box}

body{
  margin:0;
  height:100vh;
  font-family:Segoe UI,system-ui;
  background:#0a0b14;
  overflow:hidden;
  display:flex;
  justify-content:center;
  align-items:center;
  color:white;
}

/* 粒子畫布 */
canvas{
  position:fixed;
  inset:0;
  z-index:0;
  pointer-events:none; /* 關鍵修正 */
}

/* 卡片 */
.card{
  position:relative;
  z-index:2;
  backdrop-filter:blur(22px);
  background:rgba(28,28,42,0.65);
  padding:44px;
  border-radius:20px;
  width:350px;
  box-shadow:0 30px 80px rgba(0,0,0,0.8);
  border:1px solid rgba(255,255,255,0.1);
  animation:fadeUp .8s ease;
  overflow:hidden;
  transition:.4s;
}

/* 流光掃描 */
.card::before{
  content:"";
  position:absolute;
  top:-100%;
  left:-40%;
  width:180%;
  height:200%;
  background:linear-gradient(120deg,transparent,rgba(255,255,255,.08),transparent);
  transform:rotate(25deg);
  animation:scan 6s linear infinite;
}

@keyframes scan{to{top:100%}}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(20px) scale(.96)}
  to{opacity:1;transform:translateY(0) scale(1)}
}

.fadeOut{opacity:0;transform:scale(.95)}

.shake{animation:shake .4s}
@keyframes shake{
  0%{transform:translateX(0)}
  20%{transform:translateX(-6px)}
  40%{transform:translateX(6px)}
  60%{transform:translateX(-4px)}
  80%{transform:translateX(4px)}
  100%{transform:translateX(0)}
}

h1{text-align:center;margin-bottom:28px;font-weight:600}

input{
  width:100%;
  padding:14px;
  margin:10px 0;
  border:none;
  border-radius:10px;
  background:#232334;
  color:white;
  font-size:15px;
  outline:none;
  transition:.25s;
}

input:focus{
  background:#2d2d48;
  box-shadow:0 0 0 2px #5c7cff;
}

button{
  width:100%;
  padding:14px;
  margin-top:18px;
  border:none;
  border-radius:10px;
  background:linear-gradient(135deg,#5c7cff,#7d5cff);
  color:white;
  font-size:16px;
  cursor:pointer;
  font-weight:600;
  transition:.2s;
}

button:hover{
  transform:translateY(-1px);
  box-shadow:0 6px 18px rgba(92,124,255,.4);
}

.spinner{
  width:18px;
  height:18px;
  border:2px solid rgba(255,255,255,.4);
  border-top:2px solid white;
  border-radius:50%;
  animation:spin .8s linear infinite;
  margin:auto;
}

@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<canvas id="bg"></canvas>

<div class="card" id="card">
<h1>抽菸排隊系統</h1>

<form id="loginForm">
<input id="email" placeholder="帳號">
<input id="password" type="password" placeholder="密碼">
<button id="loginBtn">登入</button>
</form>
</div>

<script>
/* 粒子網格 */
const canvas=document.getElementById("bg");
const ctx=canvas.getContext("2d");
let w,h;
function resize(){w=canvas.width=innerWidth;h=canvas.height=innerHeight}
onresize=resize;resize();

const P=80;
const particles=[];
for(let i=0;i<P;i++){
  particles.push({
    x:Math.random()*w,
    y:Math.random()*h,
    vx:(Math.random()-.5)*.6,
    vy:(Math.random()-.5)*.6
  });
}

function draw(){
  ctx.clearRect(0,0,w,h);
  for(let i=0;i<P;i++){
    const a=particles[i];
    a.x+=a.vx; a.y+=a.vy;
    if(a.x<0||a.x>w)a.vx*=-1;
    if(a.y<0||a.y>h)a.vy*=-1;

    ctx.fillStyle="#7d8cff";
    ctx.beginPath();
    ctx.arc(a.x,a.y,1.5,0,6.28);
    ctx.fill();

    for(let j=i+1;j<P;j++){
      const b=particles[j];
      const dx=a.x-b.x;
      const dy=a.y-b.y;
      const d=Math.sqrt(dx*dx+dy*dy);
      if(d<120){
        ctx.strokeStyle="rgba(125,140,255,"+(1-d/120)+")";
        ctx.lineWidth=.5;
        ctx.beginPath();
        ctx.moveTo(a.x,a.y);
        ctx.lineTo(b.x,b.y);
        ctx.stroke();
      }
    }
  }
  requestAnimationFrame(draw);
}
draw();

/* Firebase */
const firebaseConfig={
  apiKey:"AIzaSyBs8g_RPs1qYdAa8_U6Uqzo3L7VZJvTWSE",
  authDomain:"smoke-queue.firebaseapp.com",
  databaseURL:"https://smoke-queue-default-rtdb.firebaseio.com",
  projectId:"smoke-queue"
};

firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

auth.onAuthStateChanged(user=>{
  if(user)location.href="app.html";
});

/* 登入 */
const form=document.getElementById("loginForm");
const btn=document.getElementById("loginBtn");
const card=document.getElementById("card");

form.addEventListener("submit",e=>{
  e.preventDefault();
  btn.disabled=true;
  btn.innerHTML='<div class="spinner"></div>';

  auth.signInWithEmailAndPassword(email.value,password.value)
  .then(()=>{
    card.classList.add("fadeOut");
    setTimeout(()=>location.href="app.html",400);
  })
  .catch(()=>{
    btn.disabled=false;
    btn.innerHTML="登入";
    card.classList.add("shake");
    setTimeout(()=>card.classList.remove("shake"),400);
  });
});
</script>

</body>
</html>
